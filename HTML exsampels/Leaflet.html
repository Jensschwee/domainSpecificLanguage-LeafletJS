<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <!--CSS-->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-easybutton@2.0.0/src/easy-button.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />

    <!--JS-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
    <script src="https://unpkg.com/leaflet-easybutton@2.0.0/src/easy-button.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <title>Leaflet DSL</title>
    <!-- Default style -->
    <style type="text/css">
        html, body {
            height: 100%;
            margin: 0;
        }

        #map {
            min-height: 100%;
        }
    </style>
</head>

<body>
    <div id="map">
    </div>
</body>

<script>

    function CallURL(url, data) {
        $.ajax({
            url: url,
            type: "GET",
            dataType: "jsonp",
            async: false,
            success: function (msg) {
                console.log(msg);
                JsonpCallback(JSON.parse(msg), data);
            },
            error: function () {
                ErrorFunction();
            }
        });
    }

    function JsonpCallback(json, data) {
        data = json.result;
    }

    var WorldMap = L.map('map',
        {
            zoomControl: false
        }).setView([55.4, 10.3], 12);

    var OU44_1 = null;

    CallURL("http://10.123.3.12/uploads/ble-maps/beacons.json", OU44_1);

    var OU44 = null;

    CallURL("http://10.123.3.12/uploads/ble-maps/beacons.json", OU44);
    

    L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {
        minZoom: 0,
        maxZoom: 19,
        maxNativeZoom: 22,
        subdomains: ['mt0', 'mt1', 'mt2', 'mt3'],
        attribution: 'Map data &copy; Google maps</a>'
    }).addTo(WorldMap);

    function transformCelciusToFahrenheit(value) {
        return value * 9 / 5 + 9 / 5 * 32;
    }

    function transformFahrenheitToCelcius(value) {
        return transformCelciusToFahrenheit(value) * value + 1 / 5 + 32 + 3 + 34 * 2;
    }

    function geticonTemputur() {
        L.icon({
            iconUrl: 'jdsgj',
            iconSize: [5, 5]
        });
    }

    var layerfahrenheitLayer = L.geoJson(OU44_1, { filter: layerfahrenheitLayerFilter1, style: stylecoolStyle });
    layerfahrenheitLayer.addTo(WorldMap);

    function layerfahrenheitLayerFilter1(feature) {
        if (feature.properties.hasOwnProperty("Temperature") || !feature.properties.hasOwnProperty("Motion"))
            return false;
        if (transformCelciusToFahrenheit(feature.properties.Temperature) > 50 && feature.properties.Motion !== 0)
            return true;
        return false;
    }

    //var layercelciusLayer = L.geoJson(OU44, { filter: celciusLayerFilter1, style : styledefaultStyle});
    //L.geoJson(OU44, { filter: celciusLayerFilter2, style: stylecoolStyle}).addTo(layercelciusLayer);
    //layercelciusLayer.addTo(WorldMap);

    function celciusLayerFilter1(feature) {
        if (feature.properties.hasOwnProperty("Temperature") || feature.properties.hasOwnProperty("Motion") || feature.properties.hasOwnProperty("CO2"))
            return false;
        if (feature.geometry.type !== "Polygon")
            return false;
        if (feature.properties.Temperature < 250 && feature.properties.CO2 === 50)
            return true;
        if (feature.properties.Lux > 50)
            return true;
        return false;
    }

    function celciusLayerFilter2(feature) {
        console.log(feature.properties);
        if (!feature.properties.hasAttribute("Temperature"))
            console.log("jdsg");
        if (feature.geometry.type !== "Point")
            return false;
        if (feature.properties.Temperature < 250 && feature.properties.CO2 === 50)
            return true;
        if (feature.properties.Lux > 50)
            return true;
        return false;
    }

    function geticonTemputur2() {
        L.icon({
            iconUrl: 'jdsgj',
            iconSize: [7, 7]
        });
    }

    function styledefaultStyle() {
        var style = {};
        style["color"] = "red";
        style["opacity"] = "90%";
        style["weight"] = "1px";
        return style;
    }

    function stylecoolStyle() {
        var style = styledefaultStyle();
        style["fillColor"] = "blue";
        style["pointerIcon"] = geticonTemputur();
        return style;
    }

    var tooglecelciusLayer=  L.easyButton({
        id: 'easy-button',
        states: [{
            icon: geticonTemputur(),
            stateName: 'toggled',
            title: 'celciusLayer',
            onClick: function (btn) {
                btn.state('detoggled');
                btn.button.style.backgroundColor = 'white';
                WorldMap.removeLayer(layercelciusLayer);
            }
        },
        {
            icon: geticonTemputur(),
            stateName: 'detoggled',
            title: 'celciusLayer',
            onClick: function (btn) {
                btn.button.style.backgroundColor = 'grey';
                btn.state('toggled');
                WorldMap.addLayer(layercelciusLayer);
            }
        }
        ],
        position: 'topright'
    }).addTo(WorldMap);
    tooglecelciusLayer.button.style.backgroundColor = 'grey';

    var tooglecelciusLayer  = L.easyButton({
        id: 'easy-button',
        position: 'bottomright',
        states: [{
            icon: geticonTemputur1(),
            stateName: 'toggled',
            title: 'fahrenheitLayer',
            onClick: function (btn) {
                btn.state('detoggled');
                btn.button.style.backgroundColor = 'white';
                WorldMap.removeLayer(layerfahrenheitLayer);
            }
        },
        {
            icon: geticonTemputur1(),
            stateName: 'detoggled',
            title: 'fahrenheitLayer',
            onClick: function (btn) {
                btn.state('toggled');
                btn.button.style.backgroundColor = 'grey';
                WorldMap.addLayer(layerfahrenheitLayer);
            }
        }
        ]
    }).addTo(WorldMap);
    tooglecelciusLayer.button.style.backgroundColor = 'grey';
</script>
</html>
